<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Maay-svncheckins] r569 - in trunk/maay: . data
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/maay-svncheckins/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:maay-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BMaay-svncheckins%5D%20r569%20-%20in%20trunk/maay%3A%20.%20data&In-Reply-To=%3C200511181447.jAIEldOK019922%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000540.html">
   <LINK REL="Next"  HREF="000542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Maay-svncheckins] r569 - in trunk/maay: . data</H1>
    <B>dnf at BerliOS</B> 
    <A HREF="mailto:maay-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BMaay-svncheckins%5D%20r569%20-%20in%20trunk/maay%3A%20.%20data&In-Reply-To=%3C200511181447.jAIEldOK019922%40sheep.berlios.de%3E"
       TITLE="[Maay-svncheckins] r569 - in trunk/maay: . data">dnf at berlios.de
       </A><BR>
    <I>Fri Nov 18 15:47:39 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000540.html">[Maay-svncheckins] r568 - trunk/maay
</A></li>
        <LI>Next message: <A HREF="000542.html">[Maay-svncheckins] r570 - in trunk: . doc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#541">[ date ]</a>
              <a href="thread.html#541">[ thread ]</a>
              <a href="subject.html#541">[ subject ]</a>
              <a href="author.html#541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dnf
Date: 2005-11-18 15:47:38 +0100 (Fri, 18 Nov 2005)
New Revision: 569

Modified:
   trunk/maay/data/liveresults.html
   trunk/maay/data/maay.css
   trunk/maay/data/searchform.html
   trunk/maay/data/skeleton.html
   trunk/maay/dbentity.py
   trunk/maay/querier.py
   trunk/maay/webapplication.py
Log:
Some esthetic modifications.



Modified: trunk/maay/data/liveresults.html
===================================================================
--- trunk/maay/data/liveresults.html	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/data/liveresults.html	2005-11-18 14:47:38 UTC (rev 569)
@@ -43,7 +43,7 @@
 
   &lt;/head&gt;
   &lt;body onload=&quot;startConnection()&quot;&gt;
-    &lt;div class=&quot;headlinks&quot;&gt;&lt;a href=&quot;/indexation&quot; class=&quot;headlink&quot;&gt;[Indexation&nbsp;Page]&nbsp;&lt;/a&gt;&lt;/div&gt;
+    &lt;div class=&quot;headlinks&quot;&gt;&lt;a href=&quot;/indexation&quot; class=&quot;headlink&quot;&gt;[Manage Folders]&lt;/a&gt;&lt;/div&gt;
     &lt;div class=&quot;reSearch&quot;&gt;
       &lt;form action=&quot;search&quot; accept-charset=&quot;utf-8&quot;&gt;
 	&lt;table&gt;

Modified: trunk/maay/data/maay.css
===================================================================
--- trunk/maay/data/maay.css	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/data/maay.css	2005-11-18 14:47:38 UTC (rev 569)
@@ -32,6 +32,11 @@
 }
 
 /** search page *******/
+div.shortDocStat {
+  font-size: 60%;
+}
+
+
 input.searchButton {
   background: #FFF0FF;
   border: 1px outset #ff2222;

Modified: trunk/maay/data/searchform.html
===================================================================
--- trunk/maay/data/searchform.html	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/data/searchform.html	2005-11-18 14:47:38 UTC (rev 569)
@@ -18,6 +18,10 @@
             &lt;input type=&quot;text&quot; name=&quot;words&quot; value=&quot;&quot; /&gt;
               &lt;input type=&quot;submit&quot; class=&quot;searchButton&quot; value=&quot;search&quot; /&gt;
           &lt;/form&gt;
+          &lt;font color=&quot;orange&quot; size=&quot;+1&quot;&gt;Search and share your documents.&lt;/font&gt;&lt;br /&gt;&lt;br /&gt;
+          &lt;div class=&quot;shortDocStat&quot; nevow:render=&quot;shortstat&quot;&gt;
+            Searching &lt;nevow:slot name=&quot;localDocumentCount&quot; /&gt; documents. Sharing &lt;nevow:slot name=&quot;publicDocumentCount&quot; /&gt; documents.
+          &lt;/div&gt;
         &lt;/td&gt;
       &lt;/tr&gt;
     &lt;/table&gt;

Modified: trunk/maay/data/skeleton.html
===================================================================
--- trunk/maay/data/skeleton.html	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/data/skeleton.html	2005-11-18 14:47:38 UTC (rev 569)
@@ -6,7 +6,7 @@
     &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;maaycss&quot;/&gt;
       &lt;link rel=&quot;shortcut icon&quot; href=&quot;images/maay.ico&quot; /&gt;
   &lt;/head&gt;
-      &lt;div class=&quot;headlinks&quot;&gt;&lt;a href=&quot;/indexation&quot; class=&quot;headlink&quot;&gt;[Indexation&nbsp;Page]&nbsp;&lt;/a&gt;&lt;/div&gt;
+      &lt;div class=&quot;headlinks&quot;&gt;&lt;a href=&quot;/indexation&quot; class=&quot;headlink&quot;&gt;[Manage Folders]&lt;/a&gt;&lt;/div&gt;
   &lt;body&gt;
     &lt;nevow:invisible nevow:macro=&quot;body&quot; /&gt;
     &lt;nevow:invisble nevow:macro=&quot;footer&quot; /&gt;

Modified: trunk/maay/dbentity.py
===================================================================
--- trunk/maay/dbentity.py	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/dbentity.py	2005-11-18 14:47:38 UTC (rev 569)
@@ -189,7 +189,9 @@
     and only a few words are known
 
     * UNKNOWN_STATE (???): not documented in the thesis, has a strange
-      value (1&lt;&lt;9) since it gets stored in a char or a signed byte
+      value (1&lt;&lt;9) since it gets stored in a char or a signed byte.
+      In fact, this state was (plan to be) used in the prototype for
+      debugging purpose. So it is a useless state... 
     &quot;&quot;&quot;
 
     # Caution : in the maay.orig branch, this parameter gets stored as
@@ -303,6 +305,19 @@
         return results[0]
     selectUrlAndTypeWhereDocid = classmethod(selectUrlAndTypeWhereDocid)
 
+    # for stat purpose
+    def getDocumentCount(cls, cursor):
+        query = &quot;SELECT state, count(*) FROM documents GROUP BY state&quot;
+        cursor.execute(query)
+        results = cursor.fetchall()
+
+        docCounts = {Document.PUBLISHED_STATE:0, Document.PRIVATE_STATE:0,
+            Document.CACHED_STATE:0, Document.KNOWN_STATE:0}
+
+        for result in results:
+            docCounts[int(result[0])] = result[1]
+        return docCounts
+    getDocumentCount = classmethod(getDocumentCount)
     
 class Result(Document):
     &quot;&quot;&quot;Results are temporary relations created/destroyed on the fly

Modified: trunk/maay/querier.py
===================================================================
--- trunk/maay/querier.py	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/querier.py	2005-11-18 14:47:38 UTC (rev 569)
@@ -60,6 +60,9 @@
         &quot;&quot;&quot;returns a list of indexed file names as strings
         &quot;&quot;&quot;
 
+    def getDocumentCount(self):
+        &quot;&quot;&quot;get document count&quot;&quot;&quot;
+
     def indexDocument(nodeId, futureDoc):
         &quot;&quot;&quot;Inserts or update information in table documents,
         file_info, document_score and word&quot;&quot;&quot;
@@ -418,6 +421,13 @@
         print &quot;removed %d rows related to unreferenced documents&quot; % rows
         return rows
 
+    def getDocumentCount(self):
+        &quot;&quot;&quot;get document count&quot;&quot;&quot;
+        cursor = self._cnx.cursor()
+        docCounts = Document.getDocumentCount(cursor)
+        cursor.close()
+        return docCounts
+
     def indexDocument(self, nodeId, futureDoc):
         &quot;&quot;&quot;Inserts or update information in table documents,
         file_info, document_score and word&quot;&quot;&quot;

Modified: trunk/maay/webapplication.py
===================================================================
--- trunk/maay/webapplication.py	2005-11-18 14:35:59 UTC (rev 568)
+++ trunk/maay/webapplication.py	2005-11-18 14:47:38 UTC (rev 569)
@@ -193,15 +193,18 @@
         self.querier = querier
         self.p2pquerier = p2pquerier
         self.download_dir = indexer.indexerConfig.download_dir
+
+    def render_shortstat(self, context, data):
+        docCounts = self.querier.getDocumentCount()
+        context.fillSlots('localDocumentCount', docCounts[Document.PRIVATE_STATE] + docCounts[Document.PUBLISHED_STATE]) 
+        context.fillSlots('publicDocumentCount', docCounts[Document.PUBLISHED_STATE]) 
+        return context.tag
         
     def logout(self):
         print &quot;Bye %s !&quot; % (self.maayId,)
         # XXX: logout message should be forwarded to presence server
         return None
 
-    def child_peers(self, context):
-        return PeersList(self.maayId, self.querier)
-
     def child_indexation(self, context, _factory=IndexationPageFactory(IndexationPage)):
         # TODO: check if the added folders are valid
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000540.html">[Maay-svncheckins] r568 - trunk/maay
</A></li>
	<LI>Next message: <A HREF="000542.html">[Maay-svncheckins] r570 - in trunk: . doc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#541">[ date ]</a>
              <a href="thread.html#541">[ thread ]</a>
              <a href="subject.html#541">[ subject ]</a>
              <a href="author.html#541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/maay-svncheckins">More information about the Maay-svncheckins
mailing list</a><br>
</body></html>
