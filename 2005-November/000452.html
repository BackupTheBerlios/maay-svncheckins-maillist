<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Maay-svncheckins] r481 - in trunk: . maay maay/test
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/maay-svncheckins/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:maay-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BMaay-svncheckins%5D%20r481%20-%20in%20trunk%3A%20.%20maay%20maay/test&In-Reply-To=%3C200511150810.jAF8AvfK008339%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000451.html">
   <LINK REL="Next"  HREF="000453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Maay-svncheckins] r481 - in trunk: . maay maay/test</H1>
    <B>Alexandre Fayolle at BerliOS</B> 
    <A HREF="mailto:maay-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BMaay-svncheckins%5D%20r481%20-%20in%20trunk%3A%20.%20maay%20maay/test&In-Reply-To=%3C200511150810.jAF8AvfK008339%40sheep.berlios.de%3E"
       TITLE="[Maay-svncheckins] r481 - in trunk: . maay maay/test">afayolle at berlios.de
       </A><BR>
    <I>Tue Nov 15 09:10:57 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000451.html">[Maay-svncheckins] r480 - in trunk: . maay maay/bin maay/test
</A></li>
        <LI>Next message: <A HREF="000453.html">[Maay-svncheckins] r482 - trunk/maay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#452">[ date ]</a>
              <a href="thread.html#452">[ thread ]</a>
              <a href="subject.html#452">[ subject ]</a>
              <a href="author.html#452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: afayolle
Date: 2005-11-15 09:10:46 +0100 (Tue, 15 Nov 2005)
New Revision: 481

Modified:
   trunk/MANIFEST.in
   trunk/maay/cleandb.py
   trunk/maay/createdb.py
   trunk/maay/dbentity.py
   trunk/maay/dbstats.py
   trunk/maay/image.py
   trunk/maay/p2pquerier.py
   trunk/maay/presenceclient.py
   trunk/maay/query.py
   trunk/maay/rpc.py
   trunk/maay/test/runtests.py
   trunk/maay/test/test_boilerplate.py
   trunk/maay/test/test_codecs.py
   trunk/maay/test/test_configuration.py
   trunk/maay/test/test_dbentity.py
   trunk/maay/test/test_image.py
   trunk/maay/test/test_indexer.py
   trunk/maay/test/test_node.py
   trunk/maay/test/test_p2p.py
   trunk/maay/test/test_querier.py
   trunk/maay/test/test_query.py
   trunk/maay/test/test_texttool.py
   trunk/maay/updateconfig.py
   trunk/maay/webapplication.py
   trunk/maayservice.py
   trunk/setup.py
Log:
added __revision__ marker, and set some props

Modified: trunk/MANIFEST.in
===================================================================
--- trunk/MANIFEST.in	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/MANIFEST.in	2005-11-15 08:10:46 UTC (rev 481)
@@ -1,8 +1,8 @@
-# revision: $Id$
-recursive-include maay/test/ *.py *.txt *.txt.bz2 *.txt.gz *.xml *.html *.ini
-recursive-include maay/data/ *.html *.css *.gif *.png *.jpg *.ico
-recursive-include maay/sql *.sql
-include maay/bin/maay-server
-include maay/bin/maay-indexer
-include ReleaseNotes
-include ChangeLog
+# revision: $Id$
+recursive-include maay/test/ *.py *.txt *.txt.bz2 *.txt.gz *.xml *.html *.ini
+recursive-include maay/data/ *.html *.css *.gif *.png *.jpg *.ico
+recursive-include maay/sql *.sql
+include maay/bin/maay-server
+include maay/bin/maay-indexer
+include ReleaseNotes
+include ChangeLog


Property changes on: trunk/MANIFEST.in
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/maay/cleandb.py
===================================================================
--- trunk/maay/cleandb.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/cleandb.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -20,6 +20,7 @@
 &quot;&quot;&quot;Utility script to clean the database. This forces full reindexation
 on the following indexer run
 &quot;&quot;&quot;
+__revision__ = '$Id$'
 
 from maay.indexer import IndexerConfiguration
 from logilab.common.db import get_dbapi_compliant_module

Modified: trunk/maay/createdb.py
===================================================================
--- trunk/maay/createdb.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/createdb.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -17,6 +17,9 @@
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
 &quot;&quot;&quot; helper to create the maay mysql instance on windows platform&quot;&quot;&quot;
+
+__revision__ = '$Id$'
+
 import os
 
 def do_delete():

Modified: trunk/maay/dbentity.py
===================================================================
--- trunk/maay/dbentity.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/dbentity.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -19,6 +19,7 @@
 &quot;&quot;&quot;this module provides a simple document abstraction&quot;&quot;&quot;
 
 __revision__ = '$Id$'
+
 __all__ = ['Document', 'FileInfo', 'DocumentProvider', 'DocumentScore',
            'Word', 'Node', 'NodeInterest', 'Result']
 

Modified: trunk/maay/dbstats.py
===================================================================
--- trunk/maay/dbstats.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/dbstats.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -18,8 +18,11 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
-&quot;&quot;&quot;Helper script to display how many rows are stored in the various maay tables on localhost&quot;&quot;&quot;
+&quot;&quot;&quot;Helper script to display how many rows are stored in the various
+maay tables on localhost&quot;&quot;&quot;
 
+__revision__ = '$Id$'
+
 from MySQLdb import connect
 from pylab import hist, show
 


Property changes on: trunk/maay/image.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native


Property changes on: trunk/maay/p2pquerier.py
___________________________________________________________________
Name: svn:keywords
   - &quot;Id&quot;
   + Id

Modified: trunk/maay/presenceclient.py
===================================================================
--- trunk/maay/presenceclient.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/presenceclient.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -16,6 +16,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 from twisted.internet import reactor
 from twisted.internet.protocol import ClientCreator
 from twisted.protocols.basic import LineReceiver


Property changes on: trunk/maay/query.py
___________________________________________________________________
Name: svn:keywords
   - &quot;Id&quot;
   + Id

Modified: trunk/maay/rpc.py
===================================================================
--- trunk/maay/rpc.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/rpc.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -25,7 +25,7 @@
 - to the peers : [distributedQuery, distributedQueryAnswer]               
 &quot;&quot;&quot;
 
-__revision__ = ''
+__revision__ = '$Id$'
 
 from time import time
 from random import randint

Modified: trunk/maay/test/runtests.py
===================================================================
--- trunk/maay/test/runtests.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/runtests.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -16,6 +16,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 from logilab.common.testlib import main
 
 if __name__ == '__main__':


Property changes on: trunk/maay/test/test_boilerplate.py
___________________________________________________________________
Name: svn:keywords
   - &quot;Id&quot;
   + Id

Modified: trunk/maay/test/test_codecs.py
===================================================================
--- trunk/maay/test/test_codecs.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_codecs.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -17,6 +17,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 import unittest
 import codecs
 import gzip

Modified: trunk/maay/test/test_configuration.py
===================================================================
--- trunk/maay/test/test_configuration.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_configuration.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -18,6 +18,8 @@
 
 &quot;&quot;&quot;small unit tests for Configuration class&quot;&quot;&quot;
 
+__revision__ = '$Id$'
+
 import unittest
 import sys
 import os

Modified: trunk/maay/test/test_dbentity.py
===================================================================
--- trunk/maay/test/test_dbentity.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_dbentity.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -19,6 +19,8 @@
 
 &quot;&quot;&quot;querier test cases&quot;&quot;&quot;
 
+__revision__ = '$Id$'
+
 import unittest
 from mimetypes import guess_type
 


Property changes on: trunk/maay/test/test_image.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/maay/test/test_indexer.py
===================================================================
--- trunk/maay/test/test_indexer.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_indexer.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -16,6 +16,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 import unittest
 from  tempfile import mkstemp
 import os

Modified: trunk/maay/test/test_node.py
===================================================================
--- trunk/maay/test/test_node.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_node.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -16,6 +16,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 import unittest
 import maay.node
 


Property changes on: trunk/maay/test/test_p2p.py
___________________________________________________________________
Name: svn:keywords
   - &quot;Id&quot;
   + Id

Modified: trunk/maay/test/test_querier.py
===================================================================
--- trunk/maay/test/test_querier.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_querier.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -19,7 +19,7 @@
 
 &quot;querier test cases&quot;&quot;&quot;
 
-__revision__ = ''
+__revision__ = '$Id$'
 
 import unittest
 import sha

Modified: trunk/maay/test/test_query.py
===================================================================
--- trunk/maay/test/test_query.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_query.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -16,6 +16,8 @@
 #     License along with this library; if not, write to the Free Software
 #     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 
+__revision__ = '$Id$'
+
 import unittest
 
 from maay.query import Query


Property changes on: trunk/maay/test/test_query.py
___________________________________________________________________
Name: svn:keywords
   - &quot;Id&quot;
   + Id

Modified: trunk/maay/test/test_texttool.py
===================================================================
--- trunk/maay/test/test_texttool.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/test/test_texttool.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -19,6 +19,7 @@
 
 &quot;&quot;&quot;unit tests for Text and HTML parsers&quot;&quot;&quot;
 
+__revision__ = '$Id$'
 
 
 import unittest

Modified: trunk/maay/updateconfig.py
===================================================================
--- trunk/maay/updateconfig.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/updateconfig.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -1,99 +1,99 @@
-#     Maay : a network of peers for document search
-#
-#     Copyright (C) 2005 France Telecom R&amp;D
-#
-#     This library is free software; you can redistribute it and/or
-#     modify it under the terms of the GNU Lesser General Public
-#     License as published by the Free Software Foundation; either
-#     version 2.1 of the License, or (at your option) any later version.
-#
-#     This library is distributed in the hope that it will be useful,
-#     but WITHOUT ANY WARRANTY; without even the implied warranty of
-#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-#     Lesser General Public License for more details.
-#
-#     You should have received a copy of the GNU Lesser General Public
-#     License along with this library; if not, write to the Free Software
-#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-
-&quot;&quot;&quot; helper to create the indexer.ini configuration file at install time on windows&quot;&quot;&quot;
-
-__revision__ = '$Id$'
-import os
-import sys
-
-indexer_config = &quot;&quot;&quot;[INDEXER]
-# Host on which the maay node is running
-host=localhost
-#Port on which the maay node is listening
-port=6789
-
-# User login on the maay node 
-user=maay
-# User password on the maay node
-password=maay
-
-# Which directories are to be indexed
-#  - private indexed directories are not available to  queries from other nodes
-#  - public indexed directories are available to these queries
-#  - skip dirs are not indexed
-#
-# If a document is available through both a public and a private directory, 
-# the public version prevails
-#
-# You can use a comma separated list of values to specify several
-# directories in each configuration variable. 
-private-index-dir=%(private)s
-private-skip-dir=%(private_skip)s
-public-index-dir=%(public)s
-public-skip-dir=%(public_skip)s
-&quot;&quot;&quot;
-
-node_config = &quot;&quot;&quot;[NODE]
-db-name=maay
-db-host=localhost
-user=maay
-password=maay
-presence-host=%(presence)s
-presence-port=%(port)d
-&quot;&quot;&quot;
-import socket
-
-def createConfigFile(myDesktop, myDocuments):
-    f=open(&quot;indexer.ini&quot;, &quot;w&quot;)
-    values = {'private'     : '%s,%s' % (myDesktop, myDocuments),
-              'private_skip': '',
-              'public'      : '%s\\Maay Documents' % myDesktop,
-              'public_skip' : '',
-              }
-    f.write(indexer_config % values)
-    f.close()
-
-    f = open(&quot;node.ini&quot;, &quot;w&quot;)
-    presence, port = probe_presence_config()
-    values = {'presence': presence,
-              'port': port}
-    f.write(node_config % values)
-    f.close()
-
-def probe_presence_config():
-    for addr in (('maay.rd.francetelecom.fr', 2345), # private FT server
-                 ('192.33.178.29', 2345), # public FT server
-                 ('172.17.1.4', 2345),    # private logilab server
-                 ('192.168.74.105', 2345),# private logilab server
-                 ):
-        print 'probing', addr
-        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
-        try:
-            s.connect(addr)
-            s.close()
-        except socket.error, exc:
-            continue
-        else:
-            return addr
-    return '192.33.178.29', 2345
-        
-    
-if __name__ == '__main__':
-    createConfigFile(sys.argv[1], sys.argv[2])
-	
+#     Maay : a network of peers for document search
+#
+#     Copyright (C) 2005 France Telecom R&amp;D
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License as published by the Free Software Foundation; either
+#     version 2.1 of the License, or (at your option) any later version.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+&quot;&quot;&quot; helper to create the indexer.ini configuration file at install time on windows&quot;&quot;&quot;
+
+__revision__ = '$Id$'
+import os
+import sys
+
+indexer_config = &quot;&quot;&quot;[INDEXER]
+# Host on which the maay node is running
+host=localhost
+#Port on which the maay node is listening
+port=6789
+
+# User login on the maay node 
+user=maay
+# User password on the maay node
+password=maay
+
+# Which directories are to be indexed
+#  - private indexed directories are not available to  queries from other nodes
+#  - public indexed directories are available to these queries
+#  - skip dirs are not indexed
+#
+# If a document is available through both a public and a private directory, 
+# the public version prevails
+#
+# You can use a comma separated list of values to specify several
+# directories in each configuration variable. 
+private-index-dir=%(private)s
+private-skip-dir=%(private_skip)s
+public-index-dir=%(public)s
+public-skip-dir=%(public_skip)s
+&quot;&quot;&quot;
+
+node_config = &quot;&quot;&quot;[NODE]
+db-name=maay
+db-host=localhost
+user=maay
+password=maay
+presence-host=%(presence)s
+presence-port=%(port)d
+&quot;&quot;&quot;
+import socket
+
+def createConfigFile(myDesktop, myDocuments):
+    f=open(&quot;indexer.ini&quot;, &quot;w&quot;)
+    values = {'private'     : '%s,%s' % (myDesktop, myDocuments),
+              'private_skip': '',
+              'public'      : '%s\\Maay Documents' % myDesktop,
+              'public_skip' : '',
+              }
+    f.write(indexer_config % values)
+    f.close()
+
+    f = open(&quot;node.ini&quot;, &quot;w&quot;)
+    presence, port = probe_presence_config()
+    values = {'presence': presence,
+              'port': port}
+    f.write(node_config % values)
+    f.close()
+
+def probe_presence_config():
+    for addr in (('maay.rd.francetelecom.fr', 2345), # private FT server
+                 ('192.33.178.29', 2345), # public FT server
+                 ('172.17.1.4', 2345),    # private logilab server
+                 ('192.168.74.105', 2345),# private logilab server
+                 ):
+        print 'probing', addr
+        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
+        try:
+            s.connect(addr)
+            s.close()
+        except socket.error, exc:
+            continue
+        else:
+            return addr
+    return '192.33.178.29', 2345
+        
+    
+if __name__ == '__main__':
+    createConfigFile(sys.argv[1], sys.argv[2])
+	


Property changes on: trunk/maay/updateconfig.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/maay/webapplication.py
===================================================================
--- trunk/maay/webapplication.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maay/webapplication.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -19,7 +19,7 @@
 
 &quot;&quot;&quot;maay local web UI script&quot;&quot;&quot;
 
-__revision__ = '$Id: server.py 281 2005-11-03 11:00:56Z aurelienc $'
+__revision__ = '$Id$'
 
 from datetime import datetime
 #from xmlrpclib import ServerProxy


Property changes on: trunk/maay/webapplication.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/maayservice.py
===================================================================
--- trunk/maayservice.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/maayservice.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -1,57 +1,59 @@
-#     Maay : a network of peers for document search
-#
-#     Copyright (C) 2005 France Telecom R&amp;D
-#
-#     This library is free software; you can redistribute it and/or
-#     modify it under the terms of the GNU Lesser General Public
-#     License as published by the Free Software Foundation; either
-#     version 2.1 of the License, or (at your option) any later version.
-#
-#     This library is distributed in the hope that it will be useful,
-#     but WITHOUT ANY WARRANTY; without even the implied warranty of
-#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-#     Lesser General Public License for more details.
-#
-#     You should have received a copy of the GNU Lesser General Public
-#     License along with this library; if not, write to the Free Software
-#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-
-import win32serviceutil
-import win32service
-import win32event
-import win32evtlogutil
-
-from twisted.internet import reactor
-
-class MyService(win32serviceutil.ServiceFramework):
-    _svc_name_ = &quot;Maay&quot;
-    _svc_display_name_ = &quot;Maay&quot;
-    _svc_deps_ = [&quot;EventLog&quot;]
-    def __init__(self, args):
-        win32serviceutil.ServiceFramework.__init__(self, args)
-
-    def SvcStop(self):
-        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
-        reactor.stop()
-
-    def SvcDoRun(self):
-        import servicemanager
-        from maay.node import run
-        win32evtlogutil.ReportEvent(self._svc_name_,
-                                    servicemanager.PYS_SERVICE_STARTED,
-                                    0, # category
-                                    servicemanager.EVENTLOG_INFORMATION_TYPE,
-                                    (self._svc_name_, ''))
-
-        run()
-        # and write a 'stopped' event to the event log.
-        win32evtlogutil.ReportEvent(self._svc_name_,
-                                    servicemanager.PYS_SERVICE_STOPPED,
-                                    0, # category
-                                    servicemanager.EVENTLOG_INFORMATION_TYPE,
-                                    (self._svc_name_, ''))
-
-
-if __name__ == '__main__':
-    # Note that this code will not be run in the 'frozen' exe-file!!!
-    win32serviceutil.HandleCommandLine(MyService)
+#     Maay : a network of peers for document search
+#
+#     Copyright (C) 2005 France Telecom R&amp;D
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License as published by the Free Software Foundation; either
+#     version 2.1 of the License, or (at your option) any later version.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+__revision__ = '$Id$'
+
+import win32serviceutil
+import win32service
+import win32event
+import win32evtlogutil
+
+from twisted.internet import reactor
+
+class MyService(win32serviceutil.ServiceFramework):
+    _svc_name_ = &quot;Maay&quot;
+    _svc_display_name_ = &quot;Maay&quot;
+    _svc_deps_ = [&quot;EventLog&quot;]
+    def __init__(self, args):
+        win32serviceutil.ServiceFramework.__init__(self, args)
+
+    def SvcStop(self):
+        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
+        reactor.stop()
+
+    def SvcDoRun(self):
+        import servicemanager
+        from maay.node import run
+        win32evtlogutil.ReportEvent(self._svc_name_,
+                                    servicemanager.PYS_SERVICE_STARTED,
+                                    0, # category
+                                    servicemanager.EVENTLOG_INFORMATION_TYPE,
+                                    (self._svc_name_, ''))
+
+        run()
+        # and write a 'stopped' event to the event log.
+        win32evtlogutil.ReportEvent(self._svc_name_,
+                                    servicemanager.PYS_SERVICE_STOPPED,
+                                    0, # category
+                                    servicemanager.EVENTLOG_INFORMATION_TYPE,
+                                    (self._svc_name_, ''))
+
+
+if __name__ == '__main__':
+    # Note that this code will not be run in the 'frozen' exe-file!!!
+    win32serviceutil.HandleCommandLine(MyService)


Property changes on: trunk/maayservice.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/setup.py
===================================================================
--- trunk/setup.py	2005-11-15 07:21:59 UTC (rev 480)
+++ trunk/setup.py	2005-11-15 08:10:46 UTC (rev 481)
@@ -1,93 +1,94 @@
-#     Maay : a network of peers for document search
-#
-#     Copyright (C) 2005 France Telecom R&amp;D
-#
-#     This library is free software; you can redistribute it and/or
-#     modify it under the terms of the GNU Lesser General Public
-#     License as published by the Free Software Foundation; either
-#     version 2.1 of the License, or (at your option) any later version.
-#
-#     This library is distributed in the hope that it will be useful,
-#     but WITHOUT ANY WARRANTY; without even the implied warranty of
-#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-#     Lesser General Public License for more details.
-#
-#     You should have received a copy of the GNU Lesser General Public
-#     License along with this library; if not, write to the Free Software
-#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-
-
-__revision__ = &quot;$Id$&quot;
-from distutils.core import setup
-import sys
-from glob import glob
-
-version = '0.2.0'
-author = &quot;France Telecom R&amp;D and Logilab&quot;
-author_email = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/maay-svncheckins">maay-dev at lists.berlios.de</A>&quot;
-copyright = &quot;Copyright (c)2004-2005 France Telecom R&amp;D&quot;
-description = &quot;a network of peers for document search&quot;
-name = &quot;Maay&quot;
-url = &quot;<A HREF="http://maay.netofpeers.net/">http://maay.netofpeers.net/</A>&quot;
-packages = ['maay']
-data_files = [('maay/data', glob('maay/data/*')+glob('maay/data/images/*')),
-                  ('maay/sql', glob('maay/sql/*.sql')),]
-scripts = ['maay/bin/maay-node', 'maay/bin/maay-indexer']
-
-
-class Target:
-    def __init__(self, **kw):
-        self.__dict__.update(kw)
-        
-maay_node = Target(description = &quot;The maay server application&quot;,
-			    icon_resources=[(1,  &quot;maay/data/images/maay.ico&quot;),],
-			    script = 'maay/node.py',
-                            includes = [&quot;MySQLdb&quot;],
-			    dest_base = &quot;maay_node&quot;)
-maay_indexer = Target(description = &quot;The maay indexer application (CLI)&quot;,
-			    icon_resources=[(1,  &quot;maay/data/images/maay.ico&quot;),],
-			    script = 'maay/indexer.py',
-			    dest_base = &quot;maay_indexer&quot;)
-createdb = Target(description = &quot;Database creation utility&quot;,
-			    script = 'maay/createdb.py',
-			    dest_base = &quot;createdb&quot;)
-
-updateConfig = Target(description = &quot;Configuration update program&quot;,
-			    script = 'maay/updateconfig.py',
-			    dest_base = &quot;updateconfig&quot;)
-
-maay_service = Target(description = &quot;The Maay service&quot;,
-                      modules = [&quot;maayservice&quot;],
-                      dest_base = &quot;Maay&quot;)
-
-if sys.platform == 'win32':
-	import py2exe
-        if len(sys.argv) == 1:
-            sys.argv.append('py2exe')
-            
-        
-	setup(console = [maay_node, maay_indexer,
-                         createdb, updateConfig],
-              service = [maay_service],
-		name = name,
-		version = version,
-		description = description,
-		author = author,
-                author_email = author_email,
-		copyright = copyright,
-		url = url
-                )
-
-else:
-	setup(
-		name = name,
-		version = version,
-		author = author,
-                author_email = author_email,
-#		copyright = copyright,
-		description = description,
-		url = url,
-		data_files = data_files,
-		packages = packages,
-                scripts = scripts
-                )
+#     Maay : a network of peers for document search
+#
+#     Copyright (C) 2005 France Telecom R&amp;D
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License as published by the Free Software Foundation; either
+#     version 2.1 of the License, or (at your option) any later version.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+
+__revision__ = &quot;$Id$&quot;
+
+from distutils.core import setup
+import sys
+from glob import glob
+
+version = '0.2.0'
+author = &quot;France Telecom R&amp;D&quot;
+author_email = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/maay-svncheckins">maay-dev at lists.berlios.de</A>&quot;
+copyright = &quot;Copyright (c)2004-2005 France Telecom R&amp;D&quot;
+description = &quot;a network of peers for document search&quot;
+name = &quot;Maay&quot;
+url = &quot;<A HREF="http://maay.netofpeers.net/">http://maay.netofpeers.net/</A>&quot;
+packages = ['maay']
+data_files = [('maay/data', glob('maay/data/*')+glob('maay/data/images/*')),
+              ('maay/sql', glob('maay/sql/*.sql')),]
+scripts = ['maay/bin/maay-node', 'maay/bin/maay-indexer']
+
+
+class Target:
+    def __init__(self, **kw):
+        self.__dict__.update(kw)
+        
+maay_node = Target(description = &quot;The maay server application&quot;,
+			    icon_resources=[(1,  &quot;maay/data/images/maay.ico&quot;),],
+			    script = 'maay/node.py',
+                            includes = [&quot;MySQLdb&quot;],
+			    dest_base = &quot;maay_node&quot;)
+maay_indexer = Target(description = &quot;The maay indexer application (CLI)&quot;,
+			    icon_resources=[(1,  &quot;maay/data/images/maay.ico&quot;),],
+			    script = 'maay/indexer.py',
+			    dest_base = &quot;maay_indexer&quot;)
+createdb = Target(description = &quot;Database creation utility&quot;,
+			    script = 'maay/createdb.py',
+			    dest_base = &quot;createdb&quot;)
+
+updateConfig = Target(description = &quot;Configuration update program&quot;,
+			    script = 'maay/updateconfig.py',
+			    dest_base = &quot;updateconfig&quot;)
+
+maay_service = Target(description = &quot;The Maay service&quot;,
+                      modules = [&quot;maayservice&quot;],
+                      dest_base = &quot;Maay&quot;)
+
+if sys.platform == 'win32':
+	import py2exe
+        if len(sys.argv) == 1:
+            sys.argv.append('py2exe')
+            
+        
+	setup(console = [maay_node, maay_indexer,
+                         createdb, updateConfig],
+              service = [maay_service],
+		name = name,
+		version = version,
+		description = description,
+		author = author,
+                author_email = author_email,
+#		copyright = copyright,
+		url = url
+                )
+
+else:
+	setup(
+		name = name,
+		version = version,
+		author = author,
+                author_email = author_email,
+#		copyright = copyright,
+		description = description,
+		url = url,
+		data_files = data_files,
+		packages = packages,
+                scripts = scripts
+                )


Property changes on: trunk/setup.py
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000451.html">[Maay-svncheckins] r480 - in trunk: . maay maay/bin maay/test
</A></li>
	<LI>Next message: <A HREF="000453.html">[Maay-svncheckins] r482 - trunk/maay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#452">[ date ]</a>
              <a href="thread.html#452">[ thread ]</a>
              <a href="subject.html#452">[ subject ]</a>
              <a href="author.html#452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/maay-svncheckins">More information about the Maay-svncheckins
mailing list</a><br>
</body></html>
